<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PayFriends — Login</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <style>
    :root{
      --bg:#0e1116; --card:#151a21; --text:#e6eef6; --muted:#a7b0bd; --accent:#3ddc97;
      --card-border: rgba(255,255,255,0.06);
      --input-bg:#10151d;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center;
    }
    .page{
      width:100%; max-width:1280px; padding:32px 16px;
      display:flex; flex-direction:column; gap:40px; align-items:center;
    }
    @media (min-width:900px){
      .page{
        flex-direction:row; align-items:flex-start; justify-content:space-between;
        gap:64px; padding:96px 32px 64px;
      }
    }

    /* HERO */
    .hero{
      flex:0 0 auto; width:100%;
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter:blur(12px);
    }
    @media (min-width:900px){
      .hero{flex:0 0 60%; width:auto; padding:28px;}
    }
    .hero h1{
      margin:0 0 16px; font-size:40px; line-height:1.15; font-weight:700;
      letter-spacing:-0.02em;
    }
    .hero-row{
      display:flex; gap:40px; align-items:flex-start;
    }
    .hero img.hero-logo{
      width:220px; max-width:30vw; height:auto; flex-shrink:0; display:block;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.35));
      margin-left:24px; margin-top:24px;
    }
    .hero-copy{max-width:640px}
    .hero p{
      color:var(--muted); line-height:1.6; margin:0 0 16px; font-size:14px;
    }

    /* Mobile hero stack */
    @media (max-width:899px){
      .hero h1{font-size:28px; text-align:center}
      .hero-row{flex-direction:column; align-items:center; gap:16px}
      .hero img.hero-logo{width:120px}
      .hero-copy{max-width:48ch}
      .hero p{text-align:center; padding:0 8px}
    }

    /* AUTH CARD */
    .card{
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      max-width:540px;
      margin:0 auto;
      flex:0 0 auto; width:100%;
    }
    @media (min-width:900px){
      .card{padding:28px; flex:0 0 40%; width:auto; max-width:640px; margin:0;}
    }
    .tabs{
      display:flex; gap:12px; border-bottom:1px solid var(--card-border);
      margin:0 0 16px;
    }
    .tab{
      appearance:none; background:none; border:none; color:var(--muted);
      padding:12px 4px; margin:0; cursor:pointer; font:inherit; font-weight:600;
      border-bottom:2px solid transparent;
    }
    .tab[aria-selected="true"]{
      color:var(--accent); border-bottom-color:var(--accent);
    }
    .form-section{display:none}
    .form-section.active{display:block}

    label{display:block; margin:10px 0 6px; color:var(--muted); font-size:14px}
    input{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--card-border);
      background:var(--input-bg); color:var(--text); font-size:15px;
      outline:none; transition:border-color .2s ease;
    }
    input:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(61,220,151,.15)}
    input::placeholder{color:#6e7785}
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:active{
      -webkit-background-clip:text;
      -webkit-text-fill-color:var(--text);
      transition:background-color 5000s ease-in-out 0s;
      box-shadow:inset 0 0 20px 20px #10151d !important;
    }
    button.primary{
      width:100%; padding:12px; border-radius:10px; border:0; margin-top:10px;
      background:var(--accent); color:#0d130f; font-weight:800; font-size:15px; cursor:pointer;
    }
    button.primary:hover{filter:brightness(1.06)}
    .row{margin-top:8px}
    .status{color:var(--muted); margin-top:12px; min-height:1.2em; font-size:14px}
    .status.error{color:#ff6b6b}

    /* Footer mini-links */
    .mini{margin-top:16px; text-align:center; color:#8691a1; font-size:12px}
    .mini a{color:#9fdcc0; text-decoration:none}
    .mini a:hover{text-decoration:underline}

    /* Screen reader only utility */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border-width:0;
    }

    /* Money Airplanes background canvas */
    #money-airplanes-canvas{
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      z-index:0;
      pointer-events:none;
    }
    .page{
      position:relative;
      z-index:1;
    }
  </style>
</head>
<body>
  <!-- Money Airplanes Background -->
  <canvas id="money-airplanes-canvas"></canvas>
  <div class="page">
    <!-- HERO (single instance, responsive) -->
    <section class="hero" aria-labelledby="pf-hero-title">
      <h1 id="pf-hero-title">Pay friends, stay friends</h1>
      <div class="hero-row">
        <!-- Use YOUR existing PNG only -->
        <img class="hero-logo" src="/images/payfriends-logov2.png" alt="PayFriends logo" />
        <div class="hero-copy">
          <p>
            Friends are GREAT!<br>
            Asking them to pay you back? NOT SO GREAT!
          </p>
          <p>
            PayFriends does the awkward stuff for you: the reminders, the nudges, the "hey… remember that money?" messages, so you don't have to become the annoying debt collector.
          </p>
          <p style="margin-left:0">✓ Clear agreements that don't feel like a contract with your friends</p>
          <p style="margin-left:0">✓ Automatic reminders so you never have to chase anyone</p>
          <p style="margin-left:0">✓ Fair recalculations for 'I'll pay a bit now and the rest later' situations</p>
          <p style="margin-left:0">✓ New plan suggestions when your friends face difficulties paying you back, solutions only</p>
          <p>
            Because friendships are priceless.........<br>
            But your money isn't!
          </p>
        </div>
      </div>
    </section>

    <!-- AUTH CARD -->
    <main class="card" aria-label="Authentication">
      <div class="tabs" role="tablist" aria-label="Auth tabs">
        <button class="tab" role="tab" aria-selected="true" aria-controls="login-section"
                id="tab-login" data-target="login">Login</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="signup-section"
                id="tab-signup" data-target="signup">Sign Up</button>
      </div>

      <!-- LOGIN -->
      <section class="form-section active" id="login-section" role="tabpanel" aria-labelledby="tab-login">
        <h2 style="margin:0 0 8px">Login</h2>
        <form id="login-form" novalidate>
          <div class="row">
            <label for="login-email" class="sr-only">Email</label>
            <input id="login-email" name="email" type="email" placeholder="you@example.com" required autocomplete="username" />
          </div>
          <div class="row">
            <label for="login-password" class="sr-only">Password</label>
            <input id="login-password" name="password" type="password" placeholder="Password" required autocomplete="current-password" />
          </div>
          <button type="submit" class="primary">Login</button>
          <p id="login-status" class="status" role="status" aria-live="polite"></p>
        </form>
      </section>

      <!-- SIGNUP -->
      <section class="form-section" id="signup-section" role="tabpanel" aria-labelledby="tab-signup">
        <h2 style="margin:0 0 8px">Create your account</h2>
        <form id="signup-form" novalidate>
          <div class="row">
            <label for="signup-fullname" class="sr-only">Full legal name (as on passport)</label>
            <input id="signup-fullname" name="fullName" type="text" placeholder="Your full name" required />
          </div>
          <div class="row">
            <label for="signup-email" class="sr-only">Email</label>
            <input id="signup-email" name="email" type="email" placeholder="you@example.com" required autocomplete="email" />
          </div>
          <div class="row">
            <label for="signup-password" class="sr-only">Password</label>
            <input id="signup-password" name="password" type="password" placeholder="Password" required autocomplete="new-password" />
          </div>
          <button type="submit" class="primary">Create account</button>
          <p id="signup-status" class="status" role="status" aria-live="polite"></p>
        </form>
      </section>

      <p class="mini">
        <a href="/terms">Terms</a> · <a href="/privacy">Privacy</a>
      </p>
    </main>
  </div>

  <!-- Money Airplanes Animated Background Component -->
  <script src="/components/payfriends-money-airplanes-background.js"></script>

  <script>
    // Initialize Money Airplanes background
    (function(){
      const canvas = document.getElementById('money-airplanes-canvas');
      if (canvas && window.PayFriendsMoneyAirplanesBackground) {
        const moneyAirplanesBg = new window.PayFriendsMoneyAirplanesBackground(canvas, {
          speed: 1,
          density: 1,
          opacity: 0.18
        });
        moneyAirplanesBg.start();

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
          moneyAirplanesBg.destroy();
        });
      }
    })();
  </script>

  <script>
    // Accessible, reliable tabs (no global 'event' reliance)
    (function(){
      const tabs = document.querySelectorAll('.tab');
      const panes = document.querySelectorAll('.form-section');

      function activate(target){
        tabs.forEach(btn=>{
          const isActive = btn.dataset.target === target;
          btn.setAttribute('aria-selected', String(isActive));
        });
        panes.forEach(pane=>{
          pane.classList.toggle('active', pane.id === target + '-section');
        });
      }

      tabs.forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          e.preventDefault();
          activate(btn.dataset.target);
        });
      });
    })();

    // LOGIN
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      const status = document.getElementById('login-status');

      status.textContent = 'Logging in...';
      status.className = 'status';

      try {
        const res = await fetch('/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Login failed');
        status.textContent = 'Success! Redirecting...';
        setTimeout(()=> window.location.href = '/app', 400);
      } catch (err) {
        status.textContent = err.message || 'Login failed';
        status.className = 'status error';
      }
    });

    // SIGNUP
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fullName = document.getElementById('signup-fullname').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;
      const status = document.getElementById('signup-status');

      if (!fullName || fullName.split(/\s+/).length < 2){
        status.textContent = 'Please enter your full name (first and last name).';
        status.className = 'status error'; return;
      }
      if (!password || password.length < 6){
        status.textContent = 'Password must be at least 6 characters.';
        status.className = 'status error'; return;
      }

      status.textContent = 'Creating account...';
      status.className = 'status';

      try {
        const res = await fetch('/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, fullName })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Signup failed');
        status.textContent = 'Account created! Redirecting...';
        setTimeout(()=> window.location.href = '/app', 400);
      } catch (err) {
        status.textContent = err.message || 'Signup failed';
        status.className = 'status error';
      }
    });
  </script>
</body>
</html>
