<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PayFriends - Login</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

  <style>
    :root{
      --bg:#0e1116; --card:#151a21; --text:#e6eef6; --muted:#a7b0bd; --accent:#3ddc97;
      --card-border: rgba(255,255,255,0.06);
      --input-bg:#10151d;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; align-items:flex-start; justify-content:center;
    }
    .page{
      width:100%; max-width:1280px; padding:80px 16px 32px;
      display:flex; flex-direction:column; gap:40px; align-items:center;
    }
    @media (min-width:900px){
      .page{
        flex-direction:row; align-items:flex-start; justify-content:space-between;
        gap:64px; padding:96px 32px 64px;
      }
    }

    /* HERO */
    .hero{
      flex:0 0 auto; width:100%;
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter:blur(12px);
    }
    @media (min-width:900px){
      .hero{flex:0 0 60%; width:auto; padding:28px;}
    }
    .hero h1{
      margin:0 0 24px; font-size:40px; line-height:1.15; font-weight:700;
      letter-spacing:-0.02em;
    }
    .hero-row{
      display:flex; gap:40px; align-items:flex-start;
    }
    .hero img.hero-logo{
      width:180px; max-width:30vw; height:auto; flex-shrink:0; display:block;
      margin-left:16px; margin-top:8px;
      position:relative;
      filter:
        drop-shadow(0 6px 14px rgba(0,0,0,.35))
        drop-shadow(0 0 60px rgba(61, 220, 151, 0.45))
        drop-shadow(0 0 90px rgba(61, 220, 151, 0.30))
        drop-shadow(0 0 120px rgba(61, 220, 151, 0.20))
        drop-shadow(0 0 150px rgba(61, 220, 151, 0.12));
    }
    .hero p{
      color:var(--muted); line-height:1.6; margin:0 0 16px; font-size:16px;
    }

    /* Features */
    .feature-list{
      list-style:none; padding:0 0 0 4px; margin:28px 0 0 0; max-width:100%;
    }
    .feature-item{
      display:flex; align-items:center; gap:7px; margin-bottom:12px;
    }
    .feature-text{
      color:#c8d2dd; font-size:15px; line-height:1.55; margin:0;
    }
    .priceless{
      font-style:italic;
      opacity:0.85;
    }

    @media (max-width:899px){
      .hero h1{font-size:28px; text-align:center}
      .hero-row{flex-direction:column; align-items:center; gap:16px}
      .hero img.hero-logo{width:120px}
    }

    /* AUTH CARD */
    .card{
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:32px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      max-width:400px;
      margin:0 auto;
      flex:0 0 auto; width:100%;
    }
    @media (min-width:900px){
      .card{flex:0 0 40%; width:auto; margin:0;}
    }
    .tabs{
      display:flex; gap:8px; border-bottom:1px solid var(--card-border);
      margin-bottom:20px;
    }
    .tab{
      background:none; border:none; color:var(--muted);
      padding:10px 4px; cursor:pointer; font-weight:600; font-size:16px;
      border-bottom:2px solid transparent;
    }
    .tab[aria-selected="true"]{
      color:var(--accent); border-bottom-color:var(--accent);
    }
    .form-section{display:none}
    .form-section.active{display:block}

    label{display:block; margin:10px 0 6px; color:var(--muted); font-size:14px}
    input{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--card-border);
      background:var(--input-bg); color:var(--text); font-size:15px;
    }
    input:focus{border-color:var(--accent)}

    button.primary{
      width:100%; padding:14px; border-radius:12px; border:0; margin-top:20px;
      background:#3bd48f; color:#0d130f; font-weight:800; font-size:17px;
    }
  </style>
</head>

<body>
  <div class="page">
    <section class="hero">
      <h1>Pay friends, stay friends</h1>
      <div class="hero-row">
        <img class="hero-logo" src="/images/payfriends-logov2.png" alt="">
        <div>
          <p>Friends are GREAT!<br>Asking them to pay you back? NOT SO GREAT!</p>
          <p>PayFriends does the awkward stuff for you: reminders, nudges, and all awkward money messages.</p>
          <p class="priceless">Because friendships are priceless...<br>But your money is not!</p>
        </div>
      </div>
    </section>

    <main class="card">
      <div class="tabs" role="tablist">
        <button class="tab" aria-selected="true" data-target="login">Login</button>
        <button class="tab" aria-selected="false" data-target="signup">Sign Up</button>
      </div>

      <section id="login-section" class="form-section active">
        <form id="login-form">
          <label>Email</label>
          <input id="login-email" type="email" placeholder="you@example.com" required>

          <label>Password</label>
          <input id="login-password" type="password" placeholder="Password" required>

          <button type="submit" class="primary">Login</button>
        </form>
      </section>

      <section id="signup-section" class="form-section">
        <form id="signup-form">
          <label>Full Name</label>
          <input id="signup-fullname" type="text" placeholder="Your full name" required>

          <label>Email</label>
          <input id="signup-email" type="email" placeholder="you@example.com" required>

          <label>Password</label>
          <input id="signup-password" type="password" placeholder="Password" required>

          <button type="submit" class="primary">Create account</button>
        </form>
      </section>
    </main>
  </div>

  <script>
    // Tabs
    const tabs=document.querySelectorAll(".tab");
    const sections=document.querySelectorAll(".form-section");
    tabs.forEach(t=>{
      t.onclick=()=>{
        tabs.forEach(x=>x.setAttribute("aria-selected","false"));
        t.setAttribute("aria-selected","true");
        sections.forEach(s=>s.classList.remove("active"));
        document.querySelector("#"+t.dataset.target+"-section").classList.add("active");
      };
    });

    // LOGIN
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;

      try {
        const res = await fetch('/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Login failed');
        window.location.href = '/app';
      } catch (err) {
        alert(err.message || 'Login failed');
      }
    });

    // SIGNUP
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fullName = document.getElementById('signup-fullname').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;

      if (!fullName || fullName.split(/\s+/).length < 2){
        alert('Please enter your full name (first and last name).');
        return;
      }
      if (!password || password.length < 6){
        alert('Password must be at least 6 characters.');
        return;
      }

      // Detect user's timezone
      let timezone = null;
      try {
        timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      } catch (e) {
        console.warn('Failed to detect timezone:', e);
      }

      try {
        const res = await fetch('/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, fullName, timezone })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Signup failed');
        window.location.href = '/app';
      } catch (err) {
        alert(err.message || 'Signup failed');
      }
    });
  </script>
</body>
</html>
