<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PayFriends &mdash; Login</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <!-- Shared footer component -->
  <script src="/js/footer.js"></script>
  <style>
    :root{
      --bg:#0e1116; --card:#151a21; --text:#e6eef6; --muted:#a7b0bd; --accent:#3ddc97;
      --card-border: rgba(255,255,255,0.06);
      --input-bg:#10151d;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;
      background:var(--bg); color:var(--text);
      min-height:100vh; display:flex; flex-direction:column; align-items:center;
    }
    .page{
      flex:1; width:100%; max-width:1280px; padding:80px 16px 32px;
      display:flex; flex-direction:column; gap:40px; align-items:center;
      justify-content:center;
    }
    @media (min-width:900px){
      .page{
        flex-direction:row; align-items:center; justify-content:space-between;
        gap:64px; padding:96px 32px 64px;
      }
    }

    /* HERO */
    .hero{
      flex:0 0 auto; width:100%;
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:24px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter:blur(12px);
    }
    @media (min-width:900px){
      .hero{flex:0 0 60%; width:auto; padding:28px;}
    }
    .hero h1{
      margin:0 0 24px; font-size:40px; line-height:1.15; font-weight:700;
      letter-spacing:-0.02em;
    }
    .hero-row{
      display:flex; gap:40px; align-items:flex-start;
    }
    .hero img.hero-logo{
      width:180px; max-width:30vw; height:auto; flex-shrink:0; display:block;
      margin-left:16px; margin-top:8px;
      position:relative;
      filter:
        drop-shadow(0 6px 14px rgba(0,0,0,.35))
        drop-shadow(0 0 60px rgba(61, 220, 151, 0.45))
        drop-shadow(0 0 90px rgba(61, 220, 151, 0.30))
        drop-shadow(0 0 120px rgba(61, 220, 151, 0.20))
        drop-shadow(0 0 150px rgba(61, 220, 151, 0.12));
    }
    .hero p{
      color:var(--muted); line-height:1.6; margin:0 0 16px; font-size:16px;
    }

    /* Feature list */
    .feature-list{
      list-style:none; padding:0 0 0 4px; margin:28px 0 0 0; max-width:100%;
    }
    .feature-item{
      display:flex; align-items:center; gap:7px; margin-bottom:12px;
    }
    .feature-item:last-child{margin-bottom:0}
    .feature-icon{
      flex-shrink:0; width:19px; height:19px;
    }
    .feature-text{
      color:#c8d2dd; font-size:15px; line-height:1.55; margin:0;
    }
    .hero-copy{max-width:440px; margin-top:4px}
    .hero-copy > p:first-child{
      font-size:18px; color:var(--text); font-weight:600;
    }
    .priceless{
      font-style:italic;
      opacity:0.85;
    }

    /* Mobile hero stack */
    @media (max-width:899px){
      .page{padding:48px 16px 32px; gap:28px; justify-content:flex-start}
      .hero h1{font-size:28px; text-align:center}
      .hero-row{flex-direction:column; align-items:center; gap:16px}
      .hero img.hero-logo{width:120px}
      .hero-copy{max-width:48ch}
      .hero p{text-align:center; padding:0 8px; font-size:15px}
      .hero-copy > p:first-child{font-size:16px}
      .feature-list{margin-left:auto; margin-right:auto}
      .card{width:95%; max-width:420px; padding:24px}
    }

    /* AUTH CARD */
    .card{
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:16px;
      padding:28px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      max-width:400px;
      margin:0 auto;
      flex:0 0 auto; width:100%;
    }
    @media (min-width:900px){
      .card{padding:32px; flex:0 0 40%; width:auto; max-width:400px; margin:0;}
    }
    .tabs{
      display:flex; gap:8px; border-bottom:1px solid var(--card-border);
      margin:0 0 20px;
    }
    .tab{
      appearance:none; background:none; border:none; color:var(--muted);
      padding:10px 4px; margin:0; cursor:pointer; font:inherit; font-weight:600;
      font-size:16px; border-bottom:2px solid transparent;
    }
    .tab[aria-selected="true"]{
      color:var(--accent); border-bottom-color:var(--accent);
    }
    .form-section{display:none}
    .form-section.active{display:block}

    label{display:block; margin:10px 0 6px; color:var(--muted); font-size:14px}
    input{
      width:100%; padding:12px 12px; border-radius:10px; border:1px solid var(--card-border);
      background:var(--input-bg); color:var(--text); font-size:15px;
      outline:none; transition:border-color .2s ease;
    }
    input:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(61,220,151,.15)}
    input::placeholder{color:#6f7881; opacity:0.75; font-size:15px}
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:active{
      -webkit-background-clip:text;
      -webkit-text-fill-color:var(--text);
      transition:background-color 5000s ease-in-out 0s;
      box-shadow:inset 0 0 20px 20px #10151d !important;
    }
    button.primary{
      width:100%; padding:14px 12px; border-radius:12px; border:0; margin-top:20px;
      background:#3bd48f; color:#0d130f; font-weight:800; font-size:17px; cursor:pointer;
    }
    button.primary:hover{filter:brightness(1.04)}
    .row{margin-top:10px}
    .status{color:var(--muted); margin-top:12px; min-height:1.2em; font-size:14px}
    .status.error{color:#ff6b6b}

    /* Screen reader only utility */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border-width:0;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HERO (single instance, responsive) -->
    <section class="hero" aria-labelledby="pf-hero-title">
      <h1 id="pf-hero-title">Pay friends, stay friends</h1>
      <div class="hero-row">
        <!-- Use YOUR existing PNG only -->
        <img class="hero-logo" src="/images/payfriends-logov2.png" alt="PayFriends logo" />
        <div class="hero-copy">
          <p>
            Friends are GREAT!<br>
            Asking them to pay you back? NOT SO GREAT!
          </p>
          <p>
            PayFriends does the awkward stuff for you: the reminders, the nudges, the "hey… remember that money?" messages, so you don't have to become the annoying debt collector.
          </p>
          <p class="priceless">
            Because friendships are priceless…<br>
            But your money isn't!
          </p>
        </div>
      </div>
      <ul class="feature-list">
        <li class="feature-item">
          <svg class="feature-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="10" stroke="#3ddc97" stroke-width="2" fill="none"/>
            <path d="M8 12.5l2.5 2.5 5.5-5.5" stroke="#3ddc97" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="feature-text">Clear agreements that don't feel like a contract with your friends</span>
        </li>
        <li class="feature-item">
          <svg class="feature-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="10" stroke="#3ddc97" stroke-width="2" fill="none"/>
            <path d="M8 12.5l2.5 2.5 5.5-5.5" stroke="#3ddc97" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="feature-text">Automatic reminders so you never have to chase anyone</span>
        </li>
        <li class="feature-item">
          <svg class="feature-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="10" stroke="#3ddc97" stroke-width="2" fill="none"/>
            <path d="M8 12.5l2.5 2.5 5.5-5.5" stroke="#3ddc97" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="feature-text">Fair recalculations for 'I'll pay a bit now and the rest later' situations</span>
        </li>
        <li class="feature-item">
          <svg class="feature-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="10" stroke="#3ddc97" stroke-width="2" fill="none"/>
            <path d="M8 12.5l2.5 2.5 5.5-5.5" stroke="#3ddc97" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="feature-text">New plan suggestions when your friends face difficulties paying you back</span>
        </li>
      </ul>
    </section>

    <!-- AUTH CARD -->
    <main class="card" aria-label="Authentication">
      <div class="tabs" role="tablist" aria-label="Auth tabs">
        <button class="tab" role="tab" aria-selected="true" aria-controls="login-section"
                id="tab-login" data-target="login">Login</button>
        <button class="tab" role="tab" aria-selected="false" aria-controls="signup-section"
                id="tab-signup" data-target="signup">Sign Up</button>
      </div>

      <!-- LOGIN -->
      <section class="form-section active" id="login-section" role="tabpanel" aria-labelledby="tab-login">
        <form id="login-form" novalidate>
          <div class="row">
            <label for="login-email" class="sr-only">Email</label>
            <input id="login-email" name="email" type="email" placeholder="you@example.com" required autocomplete="username" />
          </div>
          <div class="row">
            <label for="login-password" class="sr-only">Password</label>
            <input id="login-password" name="password" type="password" placeholder="Password" required autocomplete="current-password" />
          </div>
          <button type="submit" class="primary">Login</button>
          <p id="login-status" class="status" role="status" aria-live="polite"></p>
        </form>
      </section>

      <!-- SIGNUP -->
      <section class="form-section" id="signup-section" role="tabpanel" aria-labelledby="tab-signup">
        <form id="signup-form" novalidate>
          <div class="row">
            <label for="signup-fullname" class="sr-only">Full legal name (as on passport)</label>
            <input id="signup-fullname" name="fullName" type="text" placeholder="Your full name" required />
          </div>
          <div class="row">
            <label for="signup-email" class="sr-only">Email</label>
            <input id="signup-email" name="email" type="email" placeholder="you@example.com" required autocomplete="email" />
          </div>
          <div class="row">
            <label for="signup-password" class="sr-only">Password</label>
            <input id="signup-password" name="password" type="password" placeholder="Password" required autocomplete="new-password" />
          </div>
          <button type="submit" class="primary">Create account</button>
          <p id="signup-status" class="status" role="status" aria-live="polite"></p>
        </form>
      </section>
    </main>
  </div>

  <script>
    // Accessible, reliable tabs (no global 'event' reliance)
    (function(){
      const tabs = document.querySelectorAll('.tab');
      const panes = document.querySelectorAll('.form-section');

      function activate(target){
        tabs.forEach(btn=>{
          const isActive = btn.dataset.target === target;
          btn.setAttribute('aria-selected', String(isActive));
        });
        panes.forEach(pane=>{
          pane.classList.toggle('active', pane.id === target + '-section');
        });
      }

      tabs.forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          e.preventDefault();
          activate(btn.dataset.target);
        });
      });
    })();

    // LOGIN
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      const status = document.getElementById('login-status');

      status.textContent = 'Logging in...';
      status.className = 'status';

      try {
        const res = await fetch('/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Login failed');
        status.textContent = 'Success! Redirecting...';
        setTimeout(()=> window.location.href = '/app', 400);
      } catch (err) {
        status.textContent = err.message || 'Login failed';
        status.className = 'status error';
      }
    });

    // SIGNUP
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fullName = document.getElementById('signup-fullname').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;
      const status = document.getElementById('signup-status');

      if (!fullName || fullName.split(/\s+/).length < 2){
        status.textContent = 'Please enter your full name (first and last name).';
        status.className = 'status error'; return;
      }
      if (!password || password.length < 6){
        status.textContent = 'Password must be at least 6 characters.';
        status.className = 'status error'; return;
      }

      status.textContent = 'Creating account...';
      status.className = 'status';

      // Detect user's timezone
      let timezone = null;
      try {
        timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      } catch (e) {
        console.warn('Failed to detect timezone:', e);
      }

      try {
        const res = await fetch('/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, fullName, timezone })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Signup failed');
        status.textContent = 'Account created! Redirecting...';
        setTimeout(()=> window.location.href = '/app', 400);
      } catch (err) {
        status.textContent = err.message || 'Signup failed';
        status.className = 'status error';
      }
    });

    // Initialize footer
    if (window.PayFriendsFooter && typeof window.PayFriendsFooter.initialize === 'function') {
      window.PayFriendsFooter.initialize();
    }
  </script>
</body>
</html>
