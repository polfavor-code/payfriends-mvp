(()=>{var e={};e.id=809,e.ids=[809],e.modules={5890:e=>{"use strict";e.exports=require("better-sqlite3")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5315:e=>{"use strict";e.exports=require("path")},3834:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>o,routeModule:()=>x,tree:()=>c}),s(3075),s(9454),s(5866);var r=s(3191),a=s(8716),n=s(7922),i=s.n(n),d=s(5231),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);s.d(t,l);let c=["",{children:["loans",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3075)),"/Users/paulsomers/Dev/payfriends-mvp/admin/src/app/loans/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9454)),"/Users/paulsomers/Dev/payfriends-mvp/admin/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/paulsomers/Dev/payfriends-mvp/admin/src/app/loans/[id]/page.tsx"],u="/loans/[id]/page",m={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/loans/[id]/page",pathname:"/loans/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6477:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,9404,23)),Promise.resolve().then(s.bind(s,6626))},6626:(e,t,s)=>{"use strict";s.d(t,{AdminNotesSection:()=>d});var r=s(326),a=s(7577),n=s(5047),i=s(1223);function d({entityType:e,entityId:t,existingNotes:s}){let d=(0,n.useRouter)(),[l,c]=(0,a.useState)(""),[o,u]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),p=async s=>{if(s.preventDefault(),l.trim()){u(!0),x(null);try{let s=await fetch("/api/notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entityType:e,entityId:t,note:l.trim()})});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to add note")}c(""),d.refresh()}catch(e){x(e.message)}finally{u(!1)}}};return(0,r.jsxs)("div",{className:"admin-card p-4",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:"Internal Admin Notes"}),(0,r.jsxs)("form",{onSubmit:p,className:"mb-4",children:[r.jsx("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Add a note... (append-only)",className:"admin-input mb-2",rows:3}),m&&r.jsx("div",{className:"text-red-400 text-sm mb-2",children:m}),r.jsx("button",{type:"submit",disabled:o||!l.trim(),className:"admin-btn admin-btn-primary",children:o?"Adding...":"Add Note"})]}),r.jsx("div",{className:"space-y-3",children:0===s.length?r.jsx("p",{className:"text-sm text-gray-500",children:"No notes yet."}):s.map(e=>(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded p-3",children:[r.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.note}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:[e.admin_id," \xb7 ",(0,i.o0)(e.created_at)]})]},e.id))})]})}},7371:(e,t,s)=>{"use strict";s.d(t,{default:()=>a.a});var r=s(1812),a=s.n(r)},8585:(e,t,s)=>{"use strict";var r=s(1085);s.o(r,"notFound")&&s.d(t,{notFound:function(){return r.notFound}})},1085:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{ReadonlyURLSearchParams:function(){return i},RedirectType:function(){return r.RedirectType},notFound:function(){return a.notFound},permanentRedirect:function(){return r.permanentRedirect},redirect:function(){return r.redirect}});let r=s(3953),a=s(6399);class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class i extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6399:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{isNotFoundError:function(){return a},notFound:function(){return r}});let s="NEXT_NOT_FOUND";function r(){let e=Error(s);throw e.digest=s,e}function a(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===s}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8586:(e,t)=>{"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return s}}),function(e){e[e.SeeOther=303]="SeeOther",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect"}(s||(s={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3953:(e,t,s)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{RedirectType:function(){return r},getRedirectError:function(){return l},getRedirectStatusCodeFromError:function(){return p},getRedirectTypeFromError:function(){return x},getURLFromRedirectError:function(){return m},isRedirectError:function(){return u},permanentRedirect:function(){return o},redirect:function(){return c}});let a=s(4580),n=s(2934),i=s(8586),d="NEXT_REDIRECT";function l(e,t,s){void 0===s&&(s=i.RedirectStatusCode.TemporaryRedirect);let r=Error(d);r.digest=d+";"+t+";"+e+";"+s+";";let n=a.requestAsyncStorage.getStore();return n&&(r.mutableCookies=n.mutableCookies),r}function c(e,t){void 0===t&&(t="replace");let s=n.actionAsyncStorage.getStore();throw l(e,t,(null==s?void 0:s.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.TemporaryRedirect)}function o(e,t){void 0===t&&(t="replace");let s=n.actionAsyncStorage.getStore();throw l(e,t,(null==s?void 0:s.isAction)?i.RedirectStatusCode.SeeOther:i.RedirectStatusCode.PermanentRedirect)}function u(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,s,r,a]=e.digest.split(";",4),n=Number(a);return t===d&&("replace"===s||"push"===s)&&"string"==typeof r&&!isNaN(n)&&n in i.RedirectStatusCode}function m(e){return u(e)?e.digest.split(";",3)[2]:null}function x(e){if(!u(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function p(e){if(!u(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(function(e){e.push="push",e.replace="replace"})(r||(r={})),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},1812:(e,t,s)=>{"use strict";let{createProxy:r}=s(8570);e.exports=r("/Users/paulsomers/Dev/payfriends-mvp/admin/node_modules/next/dist/client/link.js")},3075:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u,dynamic:()=>o});var r=s(9510),a=s(7371),n=s(8585),i=s(5748),d=s(644),l=s(7566),c=s(9730);let o="force-dynamic";async function u({params:e}){let{id:t}=await e,s=(0,i.hW)(t);s||(0,n.notFound)();let o=(0,i.mg)(t),u=(0,i.rY)("loan",t),m=[{type:"system",label:"Created",timestamp:s.created_at,details:`Loan created by ${s.lender_name||"User #"+s.lender_user_id}`},...o.map(e=>({type:"payment",label:`Payment: ${(0,d.xG)(e.amount_cents)}`,timestamp:e.created_at,details:e.status||"reported"})),...u.map(e=>({type:"admin",label:"Admin Note",timestamp:e.created_at,details:e.note.substring(0,100)}))].sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime());return(0,r.jsxs)("div",{className:"max-w-5xl",children:[r.jsx("div",{className:"flex items-center gap-4 mb-6",children:r.jsx(a.default,{href:"/loans",className:"text-gray-400 hover:text-white",children:"← Back to Loans"})}),(0,r.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold",children:"Loan Detail"}),r.jsx("p",{className:"text-gray-400 font-mono text-sm mt-1",children:s.id})]}),r.jsx("span",{className:(0,d.Ue)(s.status),children:s.status})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"col-span-2 space-y-6",children:[(0,r.jsxs)("div",{className:"admin-card p-4",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:"Parties"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Lender"}),r.jsx("div",{className:"text-sm font-medium",children:s.lender_name||"—"}),s.lender_user_id&&(0,r.jsxs)(a.default,{href:`/users/${s.lender_user_id}`,className:"text-xs text-blue-400",children:["User #",s.lender_user_id]})]}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-xs text-gray-500",children:"Borrower"}),r.jsx("div",{className:"text-sm font-medium",children:s.borrower_name||s.friend_first_name||"—"}),s.borrower_user_id?(0,r.jsxs)(a.default,{href:`/users/${s.borrower_user_id}`,className:"text-xs text-blue-400",children:["User #",s.borrower_user_id]}):s.borrower_email?r.jsx("span",{className:"text-xs text-gray-400",children:s.borrower_email}):null]})]})]}),(0,r.jsxs)("div",{className:"admin-card p-4",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:"Raw Metadata"}),(0,r.jsxs)("dl",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Amount"}),r.jsx("dd",{className:"font-mono",children:(0,d.xG)(s.amount_cents)})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Interest Rate"}),r.jsx("dd",{children:s.interest_rate?`${s.interest_rate}%`:"0%"})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Repayment Type"}),r.jsx("dd",{children:s.repayment_type||"—"})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Installments"}),r.jsx("dd",{children:s.installment_count||1})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Frequency"}),r.jsx("dd",{children:s.payment_frequency||"—"})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Due Date"}),r.jsx("dd",{children:(0,d.p6)(s.due_date)})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Created"}),r.jsx("dd",{children:(0,d.o0)(s.created_at)})]}),(0,r.jsxs)("div",{children:[r.jsx("dt",{className:"text-gray-500",children:"Calc Version"}),r.jsx("dd",{className:"font-mono text-xs",children:s.calc_version||"—"})]})]})]}),(0,r.jsxs)("div",{className:"admin-card p-4",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:"Calculation Snapshot"}),(0,r.jsxs)("div",{className:"bg-gray-900 rounded p-3 font-mono text-xs overflow-x-auto",children:[r.jsx("div",{className:"text-gray-400 mb-2",children:"// Stored Inputs"}),r.jsx("pre",{className:"text-green-400",children:JSON.stringify({principal_cents:s.amount_cents,interest_rate:s.interest_rate,repayment_type:s.repayment_type,installment_count:s.installment_count,payment_frequency:s.payment_frequency,calc_version:s.calc_version},null,2)})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Use the ",r.jsx(a.default,{href:`/tools/debugger?loan_id=${s.id}`,className:"text-blue-400",children:"Calculation Debugger"})," to verify these values."]})]}),(0,r.jsxs)("div",{className:"admin-card p-4",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:"Payment Log"}),0===o.length?r.jsx("p",{className:"text-sm text-gray-500",children:"No payments recorded."}):(0,r.jsxs)("table",{className:"admin-table",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{children:[r.jsx("th",{children:"Date"}),r.jsx("th",{children:"Amount"}),r.jsx("th",{children:"Status"}),r.jsx("th",{children:"Payer"})]})}),r.jsx("tbody",{children:o.map(e=>(0,r.jsxs)("tr",{children:[r.jsx("td",{className:"text-sm",children:(0,d.o0)(e.created_at)}),r.jsx("td",{className:"font-mono",children:(0,d.xG)(e.amount_cents)}),r.jsx("td",{children:r.jsx("span",{className:(0,d.Ue)(e.status||"pending"),children:e.status||"pending"})}),r.jsx("td",{className:"text-xs text-gray-400",children:e.payer_id})]},e.id))})]})]}),r.jsx(l.b,{entityType:"loan",entityId:t,existingNotes:u})]}),r.jsx("div",{children:r.jsx(c.T,{events:m})})]})]})}},7566:(e,t,s)=>{"use strict";s.d(t,{b:()=>r});let r=(0,s(8570).createProxy)(String.raw`/Users/paulsomers/Dev/payfriends-mvp/admin/src/components/AdminNotes.tsx#AdminNotesSection`)},9730:(e,t,s)=>{"use strict";s.d(t,{T:()=>n});var r=s(9510),a=s(644);function n({events:e}){let t=e=>{switch(e){case"system":return"bg-blue-500";case"payment":return"bg-green-500";case"admin":return"bg-yellow-500";case"user":return"bg-purple-500";default:return"bg-gray-500"}};return(0,r.jsxs)("div",{className:"admin-card p-4",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-400 uppercase mb-4",children:"Timeline"}),0===e.length?r.jsx("p",{className:"text-sm text-gray-500",children:"No events."}):r.jsx("div",{className:"space-y-4",children:e.map((s,n)=>(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx("div",{className:(0,a.cn)("w-3 h-3 rounded-full",t(s.type))}),n<e.length-1&&r.jsx("div",{className:"w-px h-full bg-gray-700 min-h-[20px]"})]}),(0,r.jsxs)("div",{className:"flex-1 pb-4",children:[r.jsx("div",{className:"text-sm font-medium",children:s.label}),s.details&&r.jsx("div",{className:"text-xs text-gray-400 mt-0.5",children:s.details}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:(0,a.o0)(s.timestamp)})]})]},n))})]})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,898,86,485],()=>s(3834));module.exports=r})();