"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{3145:function(e,t,r){r.d(t,{default:function(){return n.a}});var a=r(8461),n=r.n(a)},7648:function(e,t,r){r.d(t,{default:function(){return n.a}});var a=r(2972),n=r.n(a)},9376:function(e,t,r){var a=r(5475);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},8461:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return o},getImageProps:function(){return l}});let a=r(7043),n=r(5346),s=r(5878),i=a._(r(5084));function l(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:i.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let o=s.Image},2834:function(e,t,r){r.d(t,{Footer:function(){return s}});var a=r(7437),n=r(7648);function s(){let e=new Date().getFullYear();return(0,a.jsx)("footer",{className:"mt-auto py-6 text-center text-pf-muted text-sm border-t border-pf-card-border",children:(0,a.jsxs)("div",{className:"container-pf",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-center gap-x-6 gap-y-2 mb-4",children:[(0,a.jsx)(n.default,{href:"/features",className:"hover:text-pf-text transition-colors",children:"Features"}),(0,a.jsx)(n.default,{href:"/faq",className:"hover:text-pf-text transition-colors",children:"FAQ"}),(0,a.jsx)(n.default,{href:"/legal/terms",className:"hover:text-pf-text transition-colors",children:"Terms"}),(0,a.jsx)(n.default,{href:"/legal/privacy",className:"hover:text-pf-text transition-colors",children:"Privacy"}),(0,a.jsx)(n.default,{href:"/legal/about",className:"hover:text-pf-text transition-colors",children:"About"})]}),(0,a.jsxs)("p",{className:"text-pf-muted/70",children:["\xa9 ",e," PayFriends. All rights reserved."]})]})})}},5407:function(e,t,r){r.d(t,{Header:function(){return u}});var a=r(7437),n=r(2265),s=r(7648),i=r(3145),l=r(9376),o=r(3448);function c(e){let{isOpen:t,onClose:r,initialMessages:s=[],initialUnreadCount:i=0,onUnreadCountChange:o}=e,[c,d]=(0,n.useState)(s),[u,f]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),x=(0,n.useRef)(null),p=(0,l.useRouter)(),g=c.filter(e=>!e.read_at).length;(0,n.useEffect)(()=>{t&&0===c.length&&b()},[t]),(0,n.useEffect)(()=>{function e(e){x.current&&!x.current.contains(e.target)&&r()}return t&&setTimeout(()=>{document.addEventListener("mousedown",e)},100),()=>{document.removeEventListener("mousedown",e)}},[t,r]),(0,n.useEffect)(()=>{function e(e){"Escape"===e.key&&t&&r()}return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,r]);let b=async()=>{f(!0);try{let e=await fetch("/api/messages");if(e.ok){let t=await e.json();d(t.messages||[]);let r=(t.messages||[]).filter(e=>!e.read_at).length;null==o||o(r)}}catch(e){console.error("Failed to fetch messages:",e)}finally{f(!1)}},v=async()=>{h(!0);try{(await fetch("/api/activity/mark-all-read",{method:"POST"})).ok&&(d(e=>e.map(e=>({...e,read_at:e.read_at||new Date().toISOString()}))),null==o||o(0))}catch(e){console.error("Failed to mark all as read:",e)}finally{h(!1)}},N=async e=>{try{(await fetch("/api/activity/".concat(e,"/mark-read"),{method:"POST"})).ok&&(d(t=>t.map(t=>t.id===e?{...t,read_at:t.read_at||new Date().toISOString()}:t)),null==o||o(Math.max(0,g-1)))}catch(e){console.error("Failed to mark as read:",e)}},j=e=>{e.read_at||N(e.id),e.agreement_id?(p.push("/dashboard"),r()):e.tab_id&&(p.push("/grouptabs/".concat(e.tab_id)),r())};return t?(0,a.jsxs)("div",{ref:x,className:"absolute right-0 top-full mt-2 w-[400px] max-w-[calc(100vw-32px)] bg-[#0f1419] rounded-xl border border-white/10 shadow-2xl z-50 animate-fadeIn overflow-hidden",style:{maxHeight:"calc(100vh - 120px)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-white/10 bg-pf-card/50",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Activity"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[g>0&&(0,a.jsx)("button",{onClick:v,disabled:m,className:"text-xs text-pf-accent hover:underline disabled:opacity-50",children:m?"Marking...":"Mark all read"}),(0,a.jsx)("button",{onClick:r,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-pf-muted",children:"\xd7"})]})]}),(0,a.jsx)("div",{className:"overflow-y-auto",style:{maxHeight:"calc(100vh - 200px)"},children:u?(0,a.jsx)("div",{className:"py-8 text-center text-pf-muted",children:"Loading..."}):0===c.length?(0,a.jsxs)("div",{className:"py-8 text-center text-pf-muted",children:[(0,a.jsx)("p",{className:"text-4xl mb-2",children:"\uD83D\uDCED"}),(0,a.jsx)("p",{children:"No activity yet"})]}):(0,a.jsx)("div",{className:"divide-y divide-white/5",children:c.map(e=>(0,a.jsx)("button",{onClick:()=>j(e),className:"w-full text-left px-4 py-3 transition-colors hover:bg-white/5 ".concat(e.read_at?"":"bg-pf-accent/5"),children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("span",{className:"text-xl flex-shrink-0 mt-0.5",children:function(e){switch(e){case"AGREEMENT_SENT":return"\uD83D\uDCE4";case"AGREEMENT_ACCEPTED":return"✅";case"AGREEMENT_DECLINED":return"❌";case"AGREEMENT_CANCELLED":return"\uD83D\uDEAB";case"PAYMENT_RECEIVED":return"\uD83D\uDCB0";case"PAYMENT_REMINDER":return"⏰";case"GROUPTAB_INVITE":return"\uD83D\uDCE8";case"GROUPTAB_JOINED":return"\uD83D\uDC4B";case"GROUPTAB_PAYMENT":return"\uD83D\uDCB3";default:return"\uD83D\uDCCC"}}(e.event_type)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[e.subject&&(0,a.jsx)("div",{className:"text-sm font-medium mb-0.5 ".concat(e.read_at?"text-pf-muted":"text-pf-text"),children:e.subject}),(0,a.jsx)("div",{className:"text-sm ".concat(e.read_at?"text-pf-muted":"text-pf-text"),children:function(e){let{event_type:t,body:r}=e;if(!t)return r;switch(t){case"AGREEMENT_SENT":return r||"New loan agreement sent";case"AGREEMENT_ACCEPTED":return r||"Loan agreement was accepted";case"AGREEMENT_DECLINED":return r||"Loan agreement was declined";case"AGREEMENT_CANCELLED":return r||"Loan agreement was cancelled";case"PAYMENT_RECEIVED":return r||"Payment was received";case"PAYMENT_REMINDER":return r||"Payment reminder";case"GROUPTAB_INVITE":return r||"You were invited to a GroupTab";case"GROUPTAB_JOINED":return r||"Someone joined your GroupTab";case"GROUPTAB_PAYMENT":return r||"Payment reported on GroupTab";default:return r}}(e)}),(0,a.jsx)("div",{className:"text-xs text-pf-muted/70 mt-1",title:new Date(e.created_at).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),children:function(e){let t=new Date(e),r=new Date,a=Math.floor((r.getTime()-t.getTime())/1e3),n=Math.floor(a/60),s=Math.floor(n/60),i=Math.floor(s/24);return a<60?"Just now":n<60?"".concat(n," minute").concat(1===n?"":"s"," ago"):s<24?"".concat(s," hour").concat(1===s?"":"s"," ago"):1===i?"Yesterday":i<7?"".concat(i," days ago"):t.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:t.getFullYear()!==r.getFullYear()?"numeric":void 0})}(e.created_at)})]}),!e.read_at&&(0,a.jsx)("span",{className:"w-2 h-2 rounded-full bg-pf-accent flex-shrink-0 mt-2"})]})},e.id))})}),(0,a.jsx)("div",{className:"px-4 py-2 border-t border-white/10 text-xs text-pf-muted text-center",children:"Times shown in your local timezone"})]}):null}let d=["bg-[#6366f1]","bg-[#8b5cf6]","bg-[#ec4899]","bg-[#f59e0b]","bg-[#10b981]","bg-[#3b82f6]","bg-[#14b8a6]"];function u(e){var t,r,u;let{user:m,unreadCount:h=0}=e,[x,p]=(0,n.useState)(!1),[g,b]=(0,n.useState)(!1),[v,N]=(0,n.useState)(h),j=(0,n.useRef)(null),y=(0,n.useRef)(null),E=(0,l.useRouter)(),w=(0,l.usePathname)();(0,n.useEffect)(()=>{function e(e){j.current&&!j.current.contains(e.target)&&p(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,n.useEffect)(()=>{function e(e){"Escape"===e.key&&(p(!1),b(!1))}return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]);let _=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),E.push("/login")}catch(e){console.error("Logout error:",e)}},D=(0,o.Qm)(null!==(t=null==m?void 0:m.fullName)&&void 0!==t?t:null),P=(u=null!==(r=null==m?void 0:m.fullName)&&void 0!==r?r:null)?d[(u.charCodeAt(0)||0)%d.length]:d[0],T=e=>"/dashboard"===e?"/dashboard"===w:w.startsWith(e);return(0,a.jsxs)("header",{className:"flex justify-between items-center mb-6 pb-4 border-b border-[rgba(255,255,255,0.08)] relative z-10",children:[(0,a.jsx)("div",{className:"flex items-center gap-3",children:(0,a.jsxs)(s.default,{href:"/dashboard",className:"flex items-center gap-3 no-underline",children:[(0,a.jsx)(i.default,{src:"/images/payfriends-logov2.png",alt:"PayFriends logo",width:54,height:54,className:"logo-glow"}),(0,a.jsxs)("div",{className:"flex flex-col gap-0.5",children:[(0,a.jsx)("span",{className:"text-2xl font-semibold leading-tight text-pf-text",children:"PayFriends.app"}),(0,a.jsx)("span",{className:"text-sm leading-tight text-pf-muted mt-0.5",children:"Pay friends, stay friends"})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"relative",ref:y,children:[(0,a.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),p(!1),b(!g)},className:(0,o.cn)("inline-flex items-center justify-center h-10 px-4 rounded-lg border text-sm font-medium cursor-pointer transition-all whitespace-nowrap",g?"bg-pf-card border-[rgba(255,255,255,0.06)]":"bg-transparent border-[rgba(255,255,255,0.15)] hover:bg-[rgba(255,255,255,0.05)]"),style:{minHeight:"40px"},children:[(0,a.jsx)("span",{children:"Activity"}),v>0&&(0,a.jsxs)("span",{className:"ml-1.5 text-pf-accent",children:["(",v,")"]})]}),(0,a.jsx)(c,{isOpen:g,onClose:()=>b(!1),initialUnreadCount:v,onUnreadCountChange:e=>{N(e)}})]}),(0,a.jsxs)("div",{className:"relative inline-flex items-center",ref:j,children:[(0,a.jsx)("button",{onClick:()=>{b(!1),p(!x)},className:(0,o.cn)("inline-flex items-center justify-center w-[54px] h-[54px] p-0 border-0 rounded-full bg-transparent cursor-pointer transition-all flex-shrink-0","hover:scale-105 hover:shadow-[0_0_0_2px_rgba(255,255,255,0.1)]","focus:outline-none focus:shadow-[0_0_0_2px_rgba(61,220,151,0.5)]",x&&"shadow-[0_0_0_2px_rgba(61,220,151,0.5)]"),"aria-haspopup":"true","aria-expanded":x,title:"User menu",children:(null==m?void 0:m.profilePicturePath)?(0,a.jsx)("div",{className:"w-[54px] h-[54px] rounded-full overflow-hidden",children:(0,a.jsx)(i.default,{src:"/api/profile/picture/".concat(m.id),alt:m.fullName||"User",width:54,height:54,className:"w-full h-full object-cover"})}):(0,a.jsx)("div",{className:(0,o.cn)("w-[54px] h-[54px] rounded-full flex items-center justify-center text-white font-semibold text-xl uppercase",P),children:D})}),x&&(0,a.jsx)("div",{className:"absolute right-0 top-[calc(100%+8px)] min-w-[240px] bg-[#0f1419] rounded-xl border border-[rgba(255,255,255,0.12)] shadow-[0_10px_40px_rgba(0,0,0,0.5)] py-2 z-50",style:{animation:"dropdownFadeIn 0.15s ease-out"},role:"menu",children:(0,a.jsxs)("div",{className:"px-2.5",children:[(0,a.jsxs)("div",{className:"px-2.5 py-2",children:[(0,a.jsx)("div",{className:"font-semibold text-pf-text text-sm leading-tight mb-0.5",children:(null==m?void 0:m.fullName)||"User"}),(0,a.jsx)("div",{className:"text-xs text-pf-muted leading-tight",children:null==m?void 0:m.email})]}),(0,a.jsx)("div",{className:"border-t border-[rgba(255,255,255,0.08)] my-1.5"}),(0,a.jsx)(f,{href:"/dashboard",active:T("/dashboard"),children:"Loans"}),(0,a.jsx)(f,{href:"/grouptabs",active:T("/grouptabs"),children:"GroupTabs"}),(0,a.jsx)(f,{href:"/friends",active:T("/friends"),children:"Friends"}),(0,a.jsx)("div",{className:"border-t border-[rgba(255,255,255,0.08)] my-1.5"}),(0,a.jsx)(f,{href:"/profile",active:T("/profile"),children:"My Profile"}),(0,a.jsx)(f,{href:"/settings",active:T("/settings"),children:"Settings"}),(0,a.jsx)(f,{href:"/security",active:T("/security"),children:"Security"}),(0,a.jsx)("div",{className:"border-t border-[rgba(255,255,255,0.08)] my-1.5"}),(0,a.jsx)(f,{href:"/features",active:T("/features"),children:"Features"}),(0,a.jsx)(f,{href:"/faq",active:T("/faq"),children:"FAQ"}),(0,a.jsx)(f,{href:"/legal",active:T("/legal"),children:"Legal & About"}),(null==m?void 0:m.isAdmin)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"border-t border-[rgba(255,255,255,0.08)] my-1.5"}),(0,a.jsx)(f,{href:"/admin",active:T("/admin"),children:"Admin Panel"})]}),(0,a.jsx)("div",{className:"border-t border-[rgba(255,255,255,0.08)] my-1.5"}),(0,a.jsx)("button",{onClick:_,className:"w-full text-left bg-transparent border-none px-2.5 py-2 text-sm text-[#ff6b6b] cursor-pointer rounded-md transition-colors hover:bg-[rgba(255,107,107,0.1)] font-medium",role:"menuitem",children:"Logout"})]})})]})]})]})}function f(e){let{href:t,children:r,active:n=!1}=e;return(0,a.jsx)(s.default,{href:t,className:(0,o.cn)("block w-full text-left px-2.5 py-2 text-sm cursor-pointer rounded-md transition-colors font-medium no-underline",n?"bg-[rgba(61,220,151,0.1)] text-pf-accent font-semibold":"text-pf-text hover:bg-[rgba(255,255,255,0.08)]"),role:"menuitem",children:r})}},3448:function(e,t,r){r.d(t,{Qm:function(){return i},cn:function(){return s}});var a=r(1994),n=r(3335);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,n.m6)((0,a.W)(t))}function i(e){return e?e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?"}}}]);