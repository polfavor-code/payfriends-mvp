"use strict";exports.id=2027,exports.ids=[2027],exports.modules={8088:(e,r,t)=>{t.d(r,{lx:()=>d,tG:()=>u});var a=t(7857),n=t(7721),o=t(1615);let s="https://mugsmupamjdtawpaawbh.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11Z3NtdXBhbWpkdGF3cGFhd2JoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0OTkzODMsImV4cCI6MjA4NDA3NTM4M30.4nKEmb84DbrjnR-Uml9MLWbyGZpTFSEIvqPbEYeV-P8",l=process.env.SUPABASE_SERVICE_ROLE_KEY,c=null;function u(){if(!c&&s&&l&&(c=(0,a.eI)(s,l,{auth:{autoRefreshToken:!1,persistSession:!1}})),!c)throw Error("Supabase admin client not configured. Check environment variables.");return c}async function d(){if(!s||!i)throw Error("Supabase configuration missing");let e=await (0,o.cookies)();return(0,n.createServerClient)(s,i,{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:a})=>e.set(r,t,a))}catch{}}}})}},2027:(e,r,t)=>{t.d(r,{$X:()=>S,CX:()=>o,EY:()=>k,GA:()=>n,Ji:()=>I,Nq:()=>l,Ol:()=>y,Q7:()=>h,RC:()=>A,SO:()=>d,Ut:()=>q,VA:()=>T,Yn:()=>O,_y:()=>P,aN:()=>D,ed:()=>u,g7:()=>B,gY:()=>s,hL:()=>G,hW:()=>_,hw:()=>g,l$:()=>b,l8:()=>w,o2:()=>m,r4:()=>i,t1:()=>p,xk:()=>f,y4:()=>c});var a=t(8088);async function n(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("users").select("*").eq("id",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getUserById error:",n),t}async function o(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("users").select("*").eq("email",e.toLowerCase()).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getUserByEmail error:",n),t}async function s(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("users").select("*").eq("public_id",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getUserByPublicId error:",n),t}async function i(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("users").insert({email:e.email.toLowerCase(),password_hash:e.passwordHash,full_name:e.fullName||null,public_id:e.publicId||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(n)throw console.error("[DB] createUser error:",n),n;return t}async function l(e,r){let t=(0,a.tG)(),{data:n,error:o}=await t.from("users").update({...r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw console.error("[DB] updateUser error:",o),o;return n}async function c(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("sessions").select("*").eq("id",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getSessionById error:",n),t}async function u(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("sessions").insert({id:e.id,user_id:e.userId,created_at:new Date().toISOString(),expires_at:e.expiresAt}).select().single();if(n)throw console.error("[DB] createSession error:",n),n;return t}async function d(e){let r=(0,a.tG)(),{error:t}=await r.from("sessions").delete().eq("id",e);t&&console.error("[DB] deleteSession error:",t)}async function _(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("agreements").select(`
      *,
      lender:users!agreements_lender_user_id_fkey(id, full_name, email),
      borrower:users!agreements_borrower_user_id_fkey(id, full_name, email)
    `).eq("id",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getAgreementById error:",n),t}async function g(e,r={}){let t=(0,a.tG)().from("agreements").select(`
      *,
      lender:users!agreements_lender_user_id_fkey(id, full_name, email),
      borrower:users!agreements_borrower_user_id_fkey(id, full_name, email)
    `).or(`lender_user_id.eq.${e},borrower_user_id.eq.${e}`);r.status&&(t=t.eq("status",r.status)),t=t.order("created_at",{ascending:!1}),r.limit&&(t=t.limit(r.limit));let{data:n,error:o}=await t;return o?(console.error("[DB] getAgreementsByUserId error:",o),[]):n||[]}async function m(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("agreements").insert({...e,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(n)throw console.error("[DB] createAgreement error:",n),n;return t}async function f(e,r){let t=(0,a.tG)(),{data:n,error:o}=await t.from("agreements").update({...r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw console.error("[DB] updateAgreement error:",o),o;return n}async function p(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("agreement_invites").select("*, agreement:agreements(*)").eq("token",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getInviteByToken error:",n),t}async function w(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("agreement_invites").insert({agreement_id:e.agreementId,email:e.email.toLowerCase(),token:e.token,created_at:new Date().toISOString()}).select().single();if(n)throw console.error("[DB] createInvite error:",n),n;return t}async function y(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("agreement_invites").update({accepted_at:new Date().toISOString()}).eq("token",e).select().single();if(n)throw console.error("[DB] acceptInvite error:",n),n;return t}async function S(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("payments").select("*, recorded_by:users!payments_recorded_by_user_id_fkey(id, full_name, email)").eq("agreement_id",e).order("created_at",{ascending:!1});return n?(console.error("[DB] getPaymentsByAgreementId error:",n),[]):t||[]}async function I(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("payments").insert({...e,created_at:new Date().toISOString()}).select().single();if(n)throw console.error("[DB] createPayment error:",n),n;return t}async function b(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tabs").select("*, creator:users!group_tabs_creator_user_id_fkey(id, full_name, email)").eq("id",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getGroupTabById error:",n),t}async function D(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tabs").select("*, creator:users!group_tabs_creator_user_id_fkey(id, full_name, email)").eq("magic_token",e).single();return n&&"PGRST116"!==n.code&&console.error("[DB] getGroupTabByMagicToken error:",n),t}async function G(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tabs").select("*").eq("creator_user_id",e).order("created_at",{ascending:!1}),{data:o,error:s}=await r.from("group_tab_participants").select("group_tab_id").eq("user_id",e);if(n||s)return console.error("[DB] getGroupTabsByUserId error:",n||s),[];let i=(o||[]).map(e=>e.group_tab_id);if(i.length>0){let{data:a}=await r.from("group_tabs").select("*").in("id",i).not("creator_user_id","eq",e);return[...t||[],...a||[]]}return t||[]}async function B(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tabs").insert({...e,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(n)throw console.error("[DB] createGroupTab error:",n),n;return t}async function h(e,r){let t=(0,a.tG)(),{data:n,error:o}=await t.from("group_tabs").update({...r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(o)throw console.error("[DB] updateGroupTab error:",o),o;return n}async function q(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tab_participants").select("*, user:users(id, full_name, email)").eq("group_tab_id",e).order("joined_at",{ascending:!0});return n?(console.error("[DB] getParticipantsByTabId error:",n),[]):t||[]}async function O(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tab_participants").insert({...e,joined_at:new Date().toISOString()}).select().single();if(n)throw console.error("[DB] createParticipant error:",n),n;return t}async function k(e){let r=(0,a.tG)(),{data:t,error:n}=await r.from("group_tab_payment_reports").select("*, participant:group_tab_participants(id, guest_name, user:users(id, full_name))").eq("group_tab_id",e).order("created_at",{ascending:!1});return n?(console.error("[DB] getPaymentReportsByTabId error:",n),[]):t||[]}async function T(e,r={}){let t=(0,a.tG)().from("messages").select("*").eq("user_id",e).order("created_at",{ascending:!1});r.unreadOnly&&(t=t.is("read_at",null)),r.limit&&(t=t.limit(r.limit));let{data:n,error:o}=await t;return o?(console.error("[DB] getMessagesByUserId error:",o),[]):n||[]}async function A(e){let r=(0,a.tG)(),{error:t}=await r.from("messages").update({read_at:new Date().toISOString()}).eq("id",e);t&&console.error("[DB] markMessageAsRead error:",t)}async function P(e){let r=(0,a.tG)(),{error:t}=await r.from("messages").update({read_at:new Date().toISOString()}).eq("user_id",e).is("read_at",null);t&&console.error("[DB] markAllMessagesAsRead error:",t)}}};